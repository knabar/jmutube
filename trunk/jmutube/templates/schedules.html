{% extends "master.html" %}

{% block content %}

<script type="text/javascript" src="/static/jquery-1.2.6.min.js"></script>
<script type="text/javascript" src="/static/jquery-ui-personalized-1.5.2.min.js"></script>

<style>
.ui-slider {
background-position:center center;
background-repeat:no-repeat;
height:20px;
position:relative;
width:590px;
}
.ui-slider-handle {
background-image:url(/static/slider-handle.gif);
height:23px;
left:0;
position:absolute;
top:0;
margin-top: 5px;
width:12px;
z-index:1;
}
.ui-slider-handle-active {
border:1px dotted black;
}
.ui-slider-disabled .ui-slider-handle {
opacity:0.5;
}
.ui-slider-range {
background:#50A029 none repeat scroll 0 0;
height:100%;
opacity:0.3;
position:absolute;
width:100%;
}
.ui-slider, .ui-slider-1 {
background-image:url(/static/slider-bg-1.png);
}
.ui-slider-2 {
background-image:url(/static/slider-bg.png);
}

</style>


<script type="text/javascript">

var in_update_times = false;
function update_times(new_start, new_end)
{
    if (in_update_times) return; // recursive change events
    in_update_times = true;
    var drop_start = parseInt($('#id_start').val());
    var drop_end = parseInt($('#id_end').val());
    var slider_start = $('#timerange').slider('value',0);
    var slider_end = $('#timerange').slider('value',1);
    if (new_start != drop_start || new_start != slider_start)
    {
        if (new_start == 24 *6) new_start--;
        if (new_start >= new_end) new_end = new_start + 1;
        if (new_end - new_start > 18) new_end = new_start + 18;
    }
    else
    {
        if (new_end == 0) new_end++;
        if (new_start >= new_end) new_start = new_end - 1;
        if (new_end - new_start > 18) new_start = new_end - 18;
    }
    if (new_start != drop_start) $('#id_start').val(new_start);
    if (new_end != drop_end) $('#id_end').val(new_end);
    if (new_end != slider_end) $('#timerange').slider('moveTo', new_end, 1);
    if (new_start != slider_start) $('#timerange').slider('moveTo', new_start, 0);    
    in_update_times = false;
}

$(window).bind("load", function() {
    $('#timerange').slider({ max: 24 * 6, stepping: 1, range: true,
                           handles: [{start: $('#id_start').val()},
                                     {start: $('#id_end').val()}],
                           change: function(e, ui) {
                            update_times($('#timerange').slider('value',0),$('#timerange').slider('value',1)); }
                           });

    var on_dropbox_change = function() { update_times(parseInt($('#id_start').val()), parseInt($('#id_end').val())) };
    $('#id_start').bind("change", on_dropbox_change);
    $('#id_end').bind("change", on_dropbox_change);
});
</script>

<div>You are {{ user.first_name }} {{user.last_name}}.</div>

{% if not schedules %}

<div>You do not have any schedules during the past seven days or in the future</div>

{% else %}

<h2>Your current schedules:</h2>

<table>
    <tr>
        <th>Room</th>
        <th>Time</th>
    </tr>
{% for schedule in schedules %}
    <tr>
        <td>{{ schedule.computer.building }} {{ schedule.computer.room }}</td>
        <td>{{ schedule.start_time }} to {{ schedule.end_time }}</td>
    </tr>
{% endfor %}
</table>

{% endif %}

<h2>Schedule a room</h2>

<form method="post" action="">
<table>
    {{ form }}
</table>

<input type="hidden" name="start_time" id="start_time" value="7.1666" />
<input type="hidden" name="end_time" id="end_time" value="8.1666" />

<div id='timerange' class='ui-slider-2' style="margin: 40px;">
<div class='ui-slider-handle'></div>
<div class='ui-slider-handle' style="left: 188px;"></div>	
</div>

<input type="submit" />
</form>

{% endblock %}